<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mika's Secret âœ¨</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAO1kYWIIn7fsX9spkW3IuLpPYju6RI45w",
            authDomain: "kirakira-78f87.firebaseapp.com",
            projectId: "kirakira-78f87",
            storageBucket: "kirakira-78f87.firebasestorage.app",
            messagingSenderId: "98777050685",
            appId: "1:98777050685:web:c02c15228f2780d6a40454",
            measurementId: "G-NFW7WFNEH0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        window.fb = { db, ref, set, get, child, update };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&display=swap');
        :root { --hot-pink: #ff69b4; --baby-pink: #ffdae9; --soft-pink: #fff0f5; --egg-yellow: #ffcc33; --neon-blue: #00bfff; --neon-purple: #bf00ff; }
        
        body { background: #ffeef4; font-family: 'Gaegu', cursive; margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; touch-action: none; }

        /* [1. í‘œì§€] */
        #entry-screen { position: fixed; inset: 0; background: #fdf2f5; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .analog-cover { width: 340px; height: 500px; background: #ff69b4; border-radius: 15px 40px 40px 15px; box-shadow: 15px 15px 0px rgba(0,0,0,0.1), inset -10px 0 20px rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 5px solid #fff; }
        .analog-cover::before { content: ''; position: absolute; left: 20px; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,0.3); }
        .sticker { position: absolute; background: white; padding: 5px 10px; transform: rotate(-5deg); font-weight: bold; color: var(--hot-pink); box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        .heart-btn { font-size: 60px; cursor: pointer; transition: 0.3s; animation: beat 1.5s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .lock-input { width: 140px; padding: 10px; border-radius: 20px; border: none; text-align: center; margin-top: 15px; outline: none; display: none; background: rgba(255,255,255,0.9); color: var(--hot-pink); font-family: 'Gaegu'; font-size: 18px; }

        /* [2. ê°¸ë£¨ ë°ì½” ì „ë‹¨ì§€] */
        #flyer-main { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 330px; height: 500px; background: #fff; border: 4px solid var(--hot-pink); z-index: 3000; transition: 0.4s; border-radius: 10px; box-shadow: 20px 20px 0px rgba(255,105,180,0.3); overflow: hidden; }
        #flyer-main.active { transform: translate(-50%, -50%) scale(1) rotate(-2deg); }
        .flyer-content { position: relative; width: 100%; height: 100%; padding: 20px; box-sizing: border-box; background-image: radial-gradient(#ffe4e1 1px, transparent 1px); background-size: 20px 20px; }
        .deco-txt { position: absolute; font-weight: bold; white-space: nowrap; line-height: 1; }
        .flyer-title { font-size: 32px; color: var(--hot-pink); text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 0 #fff, 4px 4px 0 var(--neon-blue); transform: rotate(-2deg); }
        .menu-list { background: rgba(255,255,255,0.8); border: 2px dashed var(--hot-pink); padding: 15px; border-radius: 10px; margin-top: 30px; z-index: 10; position: relative; }
        .menu-item { font-size: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; }

        /* [3. ë‹¤ì´ì–´ë¦¬] */
        .diary-wrapper { display: none; width: 95vw; max-width: 1000px; height: 750px; background: #fff; border-radius: 30px; border: 10px solid var(--baby-pink); position: relative; box-shadow: 0 20px 40px rgba(0,0,0,0.1); box-sizing: border-box; }
        .inner-book { display: flex; width: 100%; height: 100%; position: relative; overflow: hidden; }
        .spine { position: absolute; left: 50%; top: 0; bottom: 0; width: 40px; transform: translateX(-50%); background: linear-gradient(90deg, #e0e0e0, #fff 50%, #e0e0e0); z-index: 100; display: flex; flex-direction: column; justify-content: space-around; align-items: center; }
        .ring { width: 30px; height: 10px; background: #bbb; border-radius: 5px; }
        .page { flex: 1; width: 50%; padding: 40px; overflow-y: auto; scrollbar-width: none; position: relative; }
        .page-left { border-right: 1px solid #eee; }
        .title { font-size: 1.8rem; color: var(--hot-pink); border-bottom: 3px dotted var(--baby-pink); margin-bottom: 20px; }
        .btn { background: var(--hot-pink); color: white; border: none; padding: 8px 15px; border-radius: 12px; cursor: pointer; font-family: 'Gaegu'; box-shadow: 0 3px 0px #db7093; transition: 0.1s; }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        .input-style { border: 2px solid var(--baby-pink); border-radius: 10px; padding: 8px; font-family: 'Gaegu'; width: 100%; box-sizing: border-box; outline: none; }

        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day { aspect-ratio: 1/1; background: var(--soft-pink); border-radius: 5px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; font-size: 13px; }
        .cal-day.today { background: var(--hot-pink); color: white; }
        .cal-dot { position: absolute; bottom: 2px; width: 5px; height: 5px; background: red; border-radius: 50%; }
        .omu-plate { width: 280px; height: 160px; background: #fff; border-radius: 100%; margin: 0 auto; display: flex; align-items: center; justify-content: center; border: 2px solid #eee; }
        .omu-egg { width: 240px; height: 120px; background: var(--egg-yellow); border-radius: 120px 120px 100px 100px; position: relative; overflow: hidden; cursor: crosshair; }
        .post-it { position: absolute; width: 90px; height: 90px; background: #fff5ba; padding: 10px; box-shadow: 3px 3px 10px rgba(0,0,0,0.1); cursor: move; z-index: 50; transform: rotate(2deg); user-select: none; }
        .tabs { position: absolute; right: -50px; top: 80px; display: flex; flex-direction: column; gap: 8px; }
        .tab { background: #fff; color: var(--hot-pink); padding: 15px 8px; border-radius: 0 10px 10px 0; writing-mode: vertical-rl; cursor: pointer; border: 2px solid var(--baby-pink); border-left: none; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="entry-screen">
        <div class="analog-cover">
            <div class="sticker" style="top:20px; left:-10px;">kirakira</div>
            <div class="sticker" style="bottom:40px; right:-10px; transform:rotate(10deg);">TOP SECRET</div>
            <h1 style="color:white; font-size: 2.2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">ì°½ì›ì´ì˜ ë¹„ë°€ ì¼ê¸°</h1>
            <div class="pw-container" style="text-align:center;">
                <div class="heart-btn" onclick="document.getElementById('cover-pw').style.display='block'">ğŸ’–</div>
                <input type="password" id="cover-pw" class="lock-input" placeholder="Password?">
            </div>
        </div>
    </div>

    <div class="diary-wrapper" id="main-diary">
        <div class="spine"><div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div></div>
        <div class="inner-book">
            <div class="page page-left">
                <div class="title">My Profile ğŸ±</div>
                <div style="text-align: center;">
                    <div style="width:130px; height:130px; border-radius:50%; border:5px solid var(--baby-pink); margin:0 auto; overflow:hidden; background:var(--soft-pink); display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="document.getElementById('pf-upload').click()">
                        <img id="pf-img" src="profile.png" style="width:100%; height:100%; object-fit:cover;">
                        <input type="file" id="pf-upload" hidden onchange="changePf(event)">
                    </div>
                    <div style="margin-top:10px;">
                        <h2 id="n-disp" style="margin:0; color:var(--hot-pink);">ì°½ì›</h2>
                        <input id="n-edit" class="input-style" style="display:none; text-align:center;" value="ì°½ì›">
                        <p id="m-disp" style="color:#888; margin:5px 0;">"ì˜¤ëŠ˜ë„ í‰í™”ë¡œìš´ í•˜ë£¨~ âœ¨"</p>
                        <input id="m-edit" class="input-style" style="display:none; text-align:center;" value="ì˜¤ëŠ˜ë„ í‰í™”ë¡œìš´ í•˜ë£¨~ âœ¨">
                        <button class="btn" id="pf-btn" onclick="togglePf()" style="font-size:11px;">ìˆ˜ì •</button>
                    </div>
                </div>
                <hr style="border:1px dashed var(--baby-pink); margin:25px 0;">
                <button class="btn" style="width:100%; margin-bottom:8px; background:#7b68ee;" onclick="document.getElementById('flyer-main').classList.add('active')">ğŸ“œ ì¹´í˜ ì „ë‹¨ì§€ (ë‚™ì„œ)</button>
                <button class="btn" style="width:100%; margin-bottom:8px;" onclick="addPostIt()">ğŸ·ï¸ ë©”ëª¨ì§€ ë¶™ì´ê¸°</button>
                <button class="btn" style="width:100%; background:var(--baby-pink); color:var(--hot-pink);" onclick="saveLayout()">âœ¨ ê¾¸ë¯¸ê¸° ì €ì¥</button>
            </div>
            <div class="page page-right" id="content-view"></div>
        </div>
        </div>

    <div id="flyer-main" onclick="this.classList.remove('active')">
        <div class="flyer-content">
            <div class="flyer-title">New Menu!</div>
            <div class="menu-list">
                <div class="menu-item"><span>ğŸ³ ì˜¤ë¯€ë¼ì´ìŠ¤</span><span>1.5</span></div>
                <div class="menu-item"><span>â˜• íë‹¹ ë¼ë–¼</span><span>0.8</span></div>
                <div class="menu-item"><span>ğŸ“¸ ê°¸ë£¨ ì²´í‚¤</span><span>1.2</span></div>
            </div>
        </div>
    </div>

    <div class="tabs">
        <div class="tab" onclick="renderHome()">ğŸ  Home</div>
        <div class="tab" onclick="tpl('diary')">ğŸ“ Diary</div>
        <div class="tab" onclick="tpl('cal')">ğŸ“… Cal</div>
        <div class="tab" onclick="tpl('friends')">ğŸ‘« Friends</div>
        <div class="tab" onclick="tpl('recipe')">ğŸ‘©â€ğŸ³ Recipe</div>
        <div class="tab" onclick="tpl('omu')">ğŸ› Omu</div>
    </div>

    <script>
        const dbRef = (path) => fb.ref(fb.db, path);

        document.getElementById('cover-pw').addEventListener('keypress', async (e) => {
            if(e.key === 'Enter' && e.target.value === '0513') {
                document.getElementById('entry-screen').style.display = 'none';
                document.getElementById('main-diary').style.display = 'block';
                await loadCloudData();
                renderHome();
            }
        });

        async function loadCloudData() {
            const snap = await fb.get(dbRef('/'));
            if(snap.exists()){
                const d = snap.val();
                if(d.profile) {
                    document.getElementById('n-disp').innerText = d.profile.name || "ì°½ì›";
                    document.getElementById('m-disp').innerText = d.profile.msg || "ì˜¤ëŠ˜ë„ í‰í™”ë¡œìš´ í•˜ë£¨~ âœ¨";
                    // ì„œë²„ì— ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì„œë²„ ì´ë¯¸ì§€ ì‚¬ìš©, ì—†ìœ¼ë©´ profile.png ìœ ì§€
                    if(d.profile.img) {
                        document.getElementById('pf-img').src = d.profile.img;
                    }
                }
                if(d.layout) {
                    document.querySelectorAll('.post-it').forEach(e => e.remove());
                    d.layout.forEach(p => {
                        const el = createPostItElement(p.v, p.t, p.l);
                        document.querySelector('.inner-book').appendChild(el);
                    });
                }
            }
        }

        async function togglePf() {
            const isEdit = document.getElementById('pf-btn').innerText === "ìˆ˜ì •";
            document.getElementById('n-disp').style.display = isEdit ? 'none' : 'block';
            document.getElementById('n-edit').style.display = isEdit ? 'block' : 'none';
            document.getElementById('m-disp').style.display = isEdit ? 'none' : 'block';
            document.getElementById('m-edit').style.display = isEdit ? 'block' : 'none';
            if(!isEdit) {
                const name = document.getElementById('n-edit').value;
                const msg = document.getElementById('m-edit').value;
                await fb.update(dbRef('profile'), { name, msg });
                document.getElementById('n-disp').innerText = name;
                document.getElementById('m-disp').innerText = msg;
            }
            document.getElementById('pf-btn').innerText = isEdit ? "ì™„ë£Œ" : "ìˆ˜ì •";
        }

        async function changePf(e) {
            const r = new FileReader();
            r.onload = async () => {
                document.getElementById('pf-img').src = r.result;
                await fb.update(dbRef('profile'), { img: r.result });
            };
            r.readAsDataURL(e.target.files[0]);
        }

        // [ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ì´ì „ ì½”ë“œì™€ ë™ì¼í•˜ê²Œ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤]
        function renderHome() {
            document.getElementById('content-view').innerHTML = `<div class="title">My Secret Log ğŸ’–</div><div style="text-align:center; padding-top:100px;"><div style="font-size:80px;">ğŸ“”</div><p style="font-size:1.3rem; color:var(--hot-pink);">ì°½ì›ì´ì˜ ë¹„ë°€ ì¼ê¸°ì¥...<br>ì ˆëŒ€ ë³´ì§€ ë§ˆ!</p></div>`;
        }
        
        // ... (tpl, saveD, renderCal, saveEv, addF, renderFriends, initOmu, saveOmu, createPostItElement ë“± ë‚˜ë¨¸ì§€ ë¡œì§ ìƒëµ)
        // ìœ„ì—ì„œ ì œê³µëœ ì´ì „ ì „ì²´ ì½”ë“œì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.
    </script>
</body>
</html>
